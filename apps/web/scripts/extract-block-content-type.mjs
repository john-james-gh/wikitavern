import {writeFileSync} from "node:fs"
import {join} from "node:path"
import {execSync} from "node:child_process"
import {Schema} from "@sanity/schema"
import {schemaTypes} from "@workspace/cms-schema/schema-types"

const compiled = Schema.compile({types: schemaTypes})
const blockType = compiled.get("page").fields.find((f) => f.name === "content").type

const outPath = join(import.meta.dirname, "../lib/sanity/block-content-type.ts")
const fileContents = `
// ⚠️ AUTO-GENERATED — DO NOT EDIT THIS FILE ⚠️
export const blockContentType: any = ${JSON.stringify(blockType, null, 2)};
`
writeFileSync(outPath, fileContents.trim())
console.log("› Generated ", outPath)

// Format it with Prettier
execSync(`pnpm dlx prettier --write ${outPath}`, {stdio: "inherit"})
